machine:
  environment:
    BUILD_NUMBER: $CIRCLE_BUILD_NUM

dependencies:
  pre:
    - sudo apt-get install zip
    - sudo apt-get install tree
    - sudo apt-get install nsis

compile:
  override:
    - echo "compile build number ${BUILD_NUMBER}" 
    - echo "Duplicating common resources" 
    - cp -a src/main/resources/common/. src/main/resources/import/
    - cp -a src/main/resources/common/. src/main/resources/export/
    - echo "Making installer" 
    - tree
    - sudo ./makeInstaller ${BUILD_NUMBER}
    - echo "Making manual install packages" 
    - mkdir temp
    - tree
    - cp src/main/resources/Config.lua temp/tempConfig.lua 
    - cp -a src/main/resources/export/. temp/NetlifeExport.lrplugin 
    - cp -a temp/tempConfig.lua temp/NetlifeExport.lrplugin/Config.lua
    - cp -a src/main/resources/import/. temp/NetlifeImport.lrplugin
    - cp -a temp/tempConfig.lua temp/NetlifeImport.lrplugin/Config.lua
  post:
    - tree
    - cp target/LR-integration-setup.exe setup-plugin.exe
    - zip LR-integration setup-plugin.exe
    - cp LR-integration.zip $CIRCLE_ARTIFACTS/LR-integration.zip
    - zip $CIRCLE_ARTIFACTS/manual-plugin-installation temp/NetlifeExport.lrplugin temp/NetlifeImport.lrplugin
    - tree


test:
  override:
    - echo "no tests"

deployment:
  production:
    branch: master
    commands:
      - echo 'master'
